# Cyclic Goal Navigator

## 概要
cyclic_goal_navigatorは、TurtleBot3がコストマップ情報を基に自律的にゴールを選択し、連続的なナビゲーションを実行するノードです。

## ゴール探索アルゴリズム

### No.1アルゴリズム（前方優先探索）
**優先度：高**

前方90度範囲（ロボットの正面方向±45度）を5度刻みで探索し、最も遠い到達可能なセルをゴールとして選択します。

<img width="960" height="540" alt="無題のプレゼンテーション" src="https://github.com/user-attachments/assets/f1d7661d-992f-4cec-97fd-6449a9c5c48b" />




#### 詳細動作
1. **探索範囲**: ロボットの現在のyaw角を基準に、-45度から+45度の範囲を5度単位で扇形探索
2. **候補収集**: 各角度で最大5個の候補セルを距離の降順で収集
3. **フィルタリング**:
   - 0.3m以上離れたセルのみを候補とする
   - 重複セルの除去（10cmグリッド単位）
4. **妥当性チェック**:
   - `is_goal_valid()`: ゴール周辺3x3セルのコストチェック（80以上は危険、unknownセルも除外）
   - `is_goal_area_safe()`: ゴール周辺5x5セルの安全性評価（高コスト40%以下、unknown60%以下）
   - `is_line_free()`: ロボットからゴールまでの直線経路の遮蔽チェック（閾値50、unknownブロック）
5. **選択条件**: 
   - 距離1.0m以上の最遠候補を優先
   - Nav2による到達可能性も確認

### No.2アルゴリズム（側方探索）
**優先度：低（No.1が失敗した場合のみ実行）**

左右90度方向（真横±45度）の範囲を探索し、壁や障害物を回避しながら最も遠い到達可能なセルを選択します。

#### 詳細動作
1. **探索範囲**: 
   - 左側：90度を中心に±45度（45度〜135度）
   - 右側：-90度を中心に±45度（-135度〜-45度）
   - 各方向を5度刻みで探索
2. **候補収集**: 各角度で最大3個の候補セルを収集
3. **フィルタリング**: No.1と同様の重複除去処理
4. **妥当性チェック**:
   - より寛容な`is_line_free()`チェック（閾値90、unknownを通行可能とみなす）
   - 部分的な経路チェック：経路の50%以上がクリアなら許可
   - ゴール妥当性と到達可能性の確認
5. **緊急モード**: 全候補がブロックされた場合、最も近い候補を強制選択

## アルゴリズムの優先度設計

1. **前方優先の理由**:
   - ロボットの自然な進行方向を維持
   - 回転動作を最小限に抑え、効率的な探索を実現
   - 視界内の既知領域への移動を優先

2. **側方探索の役割**:
   - 前方が行き止まりや障害物でブロックされた場合の脱出手段
   - より広い探索範囲で新しい領域を発見
   - 部屋の壁沿いや狭い通路での移動を可能にする

3. **段階的な寛容性**:
   - No.1では厳格な安全基準（コスト閾値50）
   - No.2ではより寛容な基準（コスト閾値90、部分経路許可）
   - 最終的に緊急モードで最近傍ゴールを選択

## 実装上の特徴

- **コストマップベース**: Nav2のコストマップを直接購読し、リアルタイムで安全な経路を判定
- **TF変換**: odom/map座標系間の適切な変換処理
- **可視化**: RVizでゴールマーカーと経路を表示
- **再試行メカニズム**: ゴール失敗時は3秒後に自動再試行
- **連続ナビゲーション**: ゴール到達後、即座に次のゴールを選択
